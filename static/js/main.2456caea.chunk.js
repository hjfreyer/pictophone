(this["webpackJsonppictophone-fe"]=this["webpackJsonppictophone-fe"]||[]).push([[0],{107:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),i=r(43),o=r.n(i),s=(r(54),r(8)),p=r(9),c=r.n(p),u=r(44),d=r(16),l=r(1),m=r.n(l),y=(r(33),r(57),r(45)),g=r.n(y),f=r(17),h=r(10),b=r(19);r(70);var v=r(28);function w(e){if(0===e.length)return"";if(2===e.length){var t=e[0],r=e[1];return"M ".concat(t," ").concat(r," L ").concat(t+1," ").concat(r)}for(var n="M ".concat(e[0]," ").concat(e[1]),a=0;a<e.length;a+=2)n+="L ".concat(e[a]," ").concat(e[a+1]);return n}var I=function(e){var t=e.drawing,r=e.width,i=e.height,o=Object(n.useRef)(null);Object(n.useEffect)((function(){var e=o.current;e.style.width=r+"px",e.style.height=i+"px"}));var s={paths:t.paths.map((function(e){return function(e,t,r){for(var n=[],a=0;a<e.length;a+=2)n.push(e[a]*t,e[a+1]*r);return n}(e,r,i)}))};return a.a.createElement("svg",{ref:o},s.paths.map((function(e,t){return a.a.createElement("path",{key:t,d:w(e),stroke:"black",strokeWidth:"2",fill:"transparent"})})))},E=function(e){var t=e.draft,r=e.onChange,i=e.width,o=e.height,s=Object(n.useRef)(null);function p(e){r(Object(v.a)(t,(function(t){for(var r in e){t.inProgress[r]=t.drawing.paths.length;var n=s.current.getBoundingClientRect(),a={x:(e[r].x-n.left)/i,y:(e[r].y-n.top)/o};t.drawing.paths.push([a.x,a.y])}})))}function c(e){r(Object(v.a)(t,(function(t){for(var r in e){var n=s.current.getBoundingClientRect(),a={x:(e[r].x-n.left)/i,y:(e[r].y-n.top)/o};t.drawing.paths[t.inProgress[r]].push(a.x,a.y)}})))}function u(e){for(var t={},r=0;r<e.length;r++){var n=e.item(r);t[n.identifier]={x:n.clientX,y:n.clientY}}return t}function d(e){return{mouse:{x:e.clientX,y:e.clientY}}}return a.a.createElement("div",{ref:s,className:"canvas",onTouchStart:function(e){e.preventDefault(),p(u(e.changedTouches))},onTouchMove:function(e){e.preventDefault(),c(u(e.changedTouches))},onMouseDown:function(e){1===e.buttons&&p(d(e))},onMouseMove:function(e){1===e.buttons&&c(d(e))},style:{touchAction:"none"}},a.a.createElement(I,{drawing:t.drawing,width:i,height:o}))},j=r(11),O=r(15),P=r.n(O),k=new P.a({allErrors:!0,coerceTypes:!1,format:"fast",nullable:!0,unicode:!0,uniqueItems:!0,useDefaults:!0});k.addMetaSchema(r(27));var T=k.compile({$schema:"http://json-schema.org/draft-07/schema#",allOf:[{defaultProperties:[],properties:{paths:{items:{items:{type:"number"},type:"array"},type:"array"}},required:["paths"],type:"object"},{defaultProperties:[],properties:{kind:{enum:["drawing"],type:"string"}},required:["kind"],type:"object"}]});function R(e){if(T(e))return e;throw new Error(k.errorsText(T.errors.filter((function(e){return"if"!==e.keyword})),{dataVar:"Upload"})+"\n\n"+Object(j.inspect)(e))}var q=function(e){var t=e.playerGame,r=e.submitWord,i=e.submitDrawing,o={drawing:{paths:[]},inProgress:{}},p=Object(n.useState)(""),c=Object(s.a)(p,2),u=c[0],d=c[1],l=Object(n.useState)(o),m=Object(s.a)(l,2),y=m[0],g=m[1],f=Object(n.useState)({width:window.innerWidth,height:window.innerHeight}),h=Object(s.a)(f,2),b=h[0],v=h[1];Object(n.useEffect)((function(){return window.addEventListener("resize",(function(){return v({width:window.innerWidth,height:window.innerHeight})}))}),[]);var w=function(e){e.preventDefault(),r(u),d("")},I=function(){i(y.drawing),g(o)},j=a.a.createElement("main",{id:"game"},a.a.createElement("header",null,"Pictophone!"),a.a.createElement("div",{className:"instructions"},"Come up with a thing!"),a.a.createElement("form",{onSubmit:w},a.a.createElement("input",{value:u,onChange:function(e){return d(e.target.value)}}),a.a.createElement("button",null,"Submit"))),O=a.a.createElement("main",{id:"game"},a.a.createElement("header",null,"Pictophone!"),a.a.createElement("div",{className:"instructions"},"Chill out for a sec while everyone else finishes.")),P=3*(.7*b.height)/4,k=Math.min(P,.95*b.width),T=4*k/3;switch(t.state){case"FIRST_PROMPT":return j;case"WAITING_FOR_PROMPT":return O;case"RESPOND_TO_PROMPT":return function(e){return"word"===e.prompt.kind?a.a.createElement("main",{id:"game"},a.a.createElement("div",{className:"word-prompt"},e.prompt.word),a.a.createElement(E,{draft:y,onChange:g,width:k,height:T}),a.a.createElement("button",{onClick:I},"Submit")):a.a.createElement("main",{id:"game"},a.a.createElement(x,{drawingId:e.prompt.drawingId,width:k,height:T}),a.a.createElement("form",{onSubmit:w},a.a.createElement("input",{value:u,onChange:function(e){return d(e.target.value)}}),a.a.createElement("button",null,"Submit")))}(t)}},S=function(e){var t=e.serieses;return a.a.createElement("main",{id:"sharing"},a.a.createElement("div",{className:"series"},"Scroll this way ->"),t.map((function(e,t){return a.a.createElement("div",{key:t,className:"series"},e.entries.map((function(e,t){return a.a.createElement(_,{key:t,entry:e})})))})))},_=function(e){var t=e.entry,r=Object(n.useRef)(null),i=Object(n.useState)({width:0,height:0}),o=Object(s.a)(i,2),p=o[0],c=o[1];if(Object(n.useEffect)((function(){c({width:r.current.offsetWidth,height:r.current.offsetHeight})}),[]),"word"===t.submission.kind)return a.a.createElement("div",{ref:r,className:"words"},t.submission.word);var u=function(e,t){var r=.75*t;return Math.min(e,r)}(p.width,p.height);return a.a.createElement("div",{ref:r,className:"drawing"},a.a.createElement(x,{drawingId:t.submission.drawingId,width:u,height:4*u/3}))};var x=function(e){var t=e.drawingId,r=e.width,i=e.height,o=Object(n.useState)(null),p=Object(s.a)(o,2),u=p[0],l=p[1];return Object(n.useEffect)((function(){Object(d.a)(c.a.mark((function e(){var r,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://storage.googleapis.com/pictophone-app-drawings/".concat(t),{});case 2:return r=e.sent,e.t0=R,e.next=6,r.json();case 6:e.t1=e.sent,n=(0,e.t0)(e.t1),l(n);case 9:case"end":return e.stop()}}),e)})))()}),[t]),null===u?a.a.createElement("div",null,"Loading..."):a.a.createElement(I,{drawing:u,width:r,height:i})},N=function(e){var t=e.playerGame,r=e.startGame,n=e.submitWord,i=e.submitDrawing,o=a.a.createElement("div",null,"Players: ",t.playerIds.map((function(e,t){return a.a.createElement("div",{key:t},e)})));switch(t.state){case"UNSTARTED":return a.a.createElement("div",null,o,"Waiting to start game.",a.a.createElement("button",{onClick:r},"Start Game"));case"FIRST_PROMPT":case"WAITING_FOR_PROMPT":case"RESPOND_TO_PROMPT":return a.a.createElement(q,{playerGame:t,submitWord:n,submitDrawing:i});case"GAME_OVER":return a.a.createElement(S,{serieses:t.series})}},D=function(e){var t=e.join,r=Object(n.useState)(""),i=Object(s.a)(r,2),o=i[0],p=i[1];return a.a.createElement("div",null,a.a.createElement("h2",null,"Join A Game"),a.a.createElement("form",{onSubmit:function(e){e.preventDefault(),t(o)}},a.a.createElement("input",{type:"text",value:o,onChange:function(e){return p(e.target.value)}}),a.a.createElement("button",null,"Submit")))},M=function(e){var t=e.playerId,r=e.dispatch;return a.a.createElement("div",null,a.a.createElement("h1",null,"User page for ",t),a.a.createElement(D,{join:function(e){return r.action({version:0,kind:"join_game",playerId:t,gameId:e})}}),a.a.createElement("h2",null,"Existing Games"),a.a.createElement(f.a,{path:"versions/0/players/".concat(t,"/games"),render:function(e){var t=e.isLoading,r=e.data;return a.a.createElement("div",null,t?a.a.createElement("span",null,"Loading..."):a.a.createElement("div",null,r.map((function(e){return a.a.createElement("div",{key:e.id},a.a.createElement(b.b,{to:"/g/".concat(e.id)},e.id))}))))}}))},A=new P.a({allErrors:!0,coerceTypes:!1,format:"fast",nullable:!0,unicode:!0,uniqueItems:!0,useDefaults:!0});A.addMetaSchema(r(27));var W=A.compile({$schema:"http://json-schema.org/draft-07/schema#",anyOf:[{allOf:[{defaultProperties:[],properties:{gameId:{type:"string"},kind:{enum:["player_game"],type:"string"},playerId:{type:"string"},version:{enum:["0"],type:"string"}},required:["gameId","kind","playerId","version"],type:"object"},{defaultProperties:[],properties:{playerIds:{items:{type:"string"},type:"array"},state:{enum:["UNSTARTED"],type:"string"}},required:["playerIds","state"],type:"object"}]},{allOf:[{defaultProperties:[],properties:{gameId:{type:"string"},kind:{enum:["player_game"],type:"string"},playerId:{type:"string"},version:{enum:["0"],type:"string"}},required:["gameId","kind","playerId","version"],type:"object"},{defaultProperties:[],properties:{playerIds:{items:{type:"string"},type:"array"},state:{enum:["FIRST_PROMPT"],type:"string"}},required:["playerIds","state"],type:"object"}]},{allOf:[{defaultProperties:[],properties:{gameId:{type:"string"},kind:{enum:["player_game"],type:"string"},playerId:{type:"string"},version:{enum:["0"],type:"string"}},required:["gameId","kind","playerId","version"],type:"object"},{defaultProperties:[],properties:{playerIds:{items:{type:"string"},type:"array"},state:{enum:["WAITING_FOR_PROMPT"],type:"string"}},required:["playerIds","state"],type:"object"}]},{allOf:[{defaultProperties:[],properties:{gameId:{type:"string"},kind:{enum:["player_game"],type:"string"},playerId:{type:"string"},version:{enum:["0"],type:"string"}},required:["gameId","kind","playerId","version"],type:"object"},{defaultProperties:[],properties:{playerIds:{items:{type:"string"},type:"array"},prompt:{anyOf:[{defaultProperties:[],properties:{kind:{enum:["word"],type:"string"},word:{type:"string"}},required:["kind","word"],type:"object"},{defaultProperties:[],properties:{drawingId:{type:"string"},kind:{enum:["drawing"],type:"string"}},required:["drawingId","kind"],type:"object"}]},state:{enum:["RESPOND_TO_PROMPT"],type:"string"}},required:["playerIds","prompt","state"],type:"object"}]},{allOf:[{defaultProperties:[],properties:{gameId:{type:"string"},kind:{enum:["player_game"],type:"string"},playerId:{type:"string"},version:{enum:["0"],type:"string"}},required:["gameId","kind","playerId","version"],type:"object"},{defaultProperties:[],properties:{playerIds:{items:{type:"string"},type:"array"},series:{items:{defaultProperties:[],properties:{entries:{items:{defaultProperties:[],properties:{playerId:{type:"string"},submission:{anyOf:[{defaultProperties:[],properties:{kind:{enum:["word"],type:"string"},word:{type:"string"}},required:["kind","word"],type:"object"},{defaultProperties:[],properties:{drawingId:{type:"string"},kind:{enum:["drawing"],type:"string"}},required:["drawingId","kind"],type:"object"}]}},required:["playerId","submission"],type:"object"},type:"array"}},required:["entries"],type:"object"},type:"array"},state:{enum:["GAME_OVER"],type:"string"}},required:["playerIds","series","state"],type:"object"}]},{allOf:[{defaultProperties:[],properties:{gameId:{type:"string"},kind:{enum:["player_game"],type:"string"},playerId:{type:"string"},version:{enum:["v1.0.0"],type:"string"}},required:["gameId","kind","playerId","version"],type:"object"},{defaultProperties:[],properties:{players:{additionalProperties:{defaultProperties:[],properties:{displayName:{type:"string"}},required:["displayName"],type:"object"},defaultProperties:[],type:"object"},state:{enum:["UNSTARTED"],type:"string"}},required:["players","state"],type:"object"}]},{allOf:[{defaultProperties:[],properties:{gameId:{type:"string"},kind:{enum:["player_game"],type:"string"},playerId:{type:"string"},version:{enum:["v1.0.0"],type:"string"}},required:["gameId","kind","playerId","version"],type:"object"},{defaultProperties:[],properties:{players:{additionalProperties:{defaultProperties:[],properties:{displayName:{type:"string"}},required:["displayName"],type:"object"},defaultProperties:[],type:"object"},state:{enum:["FIRST_PROMPT"],type:"string"}},required:["players","state"],type:"object"}]},{allOf:[{defaultProperties:[],properties:{gameId:{type:"string"},kind:{enum:["player_game"],type:"string"},playerId:{type:"string"},version:{enum:["v1.0.0"],type:"string"}},required:["gameId","kind","playerId","version"],type:"object"},{defaultProperties:[],properties:{players:{additionalProperties:{defaultProperties:[],properties:{displayName:{type:"string"}},required:["displayName"],type:"object"},defaultProperties:[],type:"object"},state:{enum:["WAITING_FOR_PROMPT"],type:"string"}},required:["players","state"],type:"object"}]},{allOf:[{defaultProperties:[],properties:{gameId:{type:"string"},kind:{enum:["player_game"],type:"string"},playerId:{type:"string"},version:{enum:["v1.0.0"],type:"string"}},required:["gameId","kind","playerId","version"],type:"object"},{defaultProperties:[],properties:{players:{additionalProperties:{defaultProperties:[],properties:{displayName:{type:"string"}},required:["displayName"],type:"object"},defaultProperties:[],type:"object"},prompt:{anyOf:[{defaultProperties:[],properties:{kind:{enum:["word"],type:"string"},word:{type:"string"}},required:["kind","word"],type:"object"},{defaultProperties:[],properties:{drawingId:{type:"string"},kind:{enum:["drawing"],type:"string"}},required:["drawingId","kind"],type:"object"}]},state:{enum:["RESPOND_TO_PROMPT"],type:"string"}},required:["players","prompt","state"],type:"object"}]},{allOf:[{defaultProperties:[],properties:{gameId:{type:"string"},kind:{enum:["player_game"],type:"string"},playerId:{type:"string"},version:{enum:["v1.0.0"],type:"string"}},required:["gameId","kind","playerId","version"],type:"object"},{defaultProperties:[],properties:{players:{additionalProperties:{defaultProperties:[],properties:{displayName:{type:"string"}},required:["displayName"],type:"object"},defaultProperties:[],type:"object"},series:{items:{defaultProperties:[],properties:{entries:{items:{defaultProperties:[],properties:{playerId:{type:"string"},submission:{anyOf:[{defaultProperties:[],properties:{kind:{enum:["word"],type:"string"},word:{type:"string"}},required:["kind","word"],type:"object"},{defaultProperties:[],properties:{drawingId:{type:"string"},kind:{enum:["drawing"],type:"string"}},required:["drawingId","kind"],type:"object"}]}},required:["playerId","submission"],type:"object"},type:"array"}},required:["entries"],type:"object"},type:"array"},state:{enum:["GAME_OVER"],type:"string"}},required:["players","series","state"],type:"object"}]}]});var C=new P.a({allErrors:!0,coerceTypes:!1,format:"fast",nullable:!0,unicode:!0,uniqueItems:!0,useDefaults:!0});C.addMetaSchema(r(27));var G=C.compile({$schema:"http://json-schema.org/draft-07/schema#",defaultProperties:[],properties:{id:{type:"string"}},required:["id"],type:"object"});function L(e){if(G(e))return e;throw new Error(C.errorsText(G.errors.filter((function(e){return"if"!==e.keyword})),{dataVar:"UploadResponse"})+"\n\n"+Object(j.inspect)(e))}var U=r(48);function F(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function V(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?F(r,!0).forEach((function(t){Object(u.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var B={apiKey:"AIzaSyCzMg7Q2ByK5UxUd_x730LT8TmOmbA61MU",authDomain:"pictophone-app.firebaseapp.com",databaseURL:"https://pictophone-app.firebaseio.com",projectId:"pictophone-app",storageBucket:"pictophone-app-drawings",messagingSenderId:"837882351009",appId:"1:837882351009:web:9056a6b26d58fb373ecfe0"},J=m.a.initializeApp(B).auth(),z={signInFlow:"popup",signInOptions:[m.a.auth.GoogleAuthProvider.PROVIDER_ID,m.a.auth.EmailAuthProvider.PROVIDER_ID],callbacks:{signInSuccessWithAuthResult:function(){return!1}}},H=function(){return a.a.createElement(a.a.Fragment,null,a.a.createElement("h1",null,"Hey it's Pictophone!"),a.a.createElement("p",null,"Care to sign in?"),a.a.createElement(g.a,{uiConfig:z,firebaseAuth:m.a.auth()}))},$=function(e){var t=e.playerId,r=e.dispatch,n=Object(h.h)().gameId,i=function(){return r.action({version:0,kind:"start_game",playerId:t,gameId:n})},o=function(e){return r.action({version:0,kind:"make_move",playerId:t,gameId:n,submission:{kind:"word",word:e}})},s=function(){var e=Object(d.a)(c.a.mark((function e(a){var i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.upload(V({kind:"drawing"},a));case 2:return i=e.sent,e.next=5,r.action({version:0,kind:"make_move",playerId:t,gameId:n,submission:{kind:"drawing",drawingId:i.id}});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return a.a.createElement(f.b,{path:"versions/0/players/".concat(t,"/games/").concat(n),render:function(e){var t=e.isLoading,r=e.data;if(t)return a.a.createElement("span",null,"Loading...");var n=function(e){if(W(e))return e;throw new Error(A.errorsText(W.errors.filter((function(e){return"if"!==e.keyword})),{dataVar:"Export"})+"\n\n"+Object(j.inspect)(e))}(r);return Object(U.strict)("0"===n.version),a.a.createElement(N,{playerGame:n,startGame:i,submitWord:o,submitDrawing:s})}})};function K(e){return X.apply(this,arguments)}function X(){return(X=Object(d.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.pictophone.app/action",{method:"post",body:JSON.stringify(t),mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json"}});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e){return Q.apply(this,arguments)}function Q(){return(Q=Object(d.a)(c.a.mark((function e(t){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.pictophone.app/upload",{method:"post",body:JSON.stringify(t),mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json"}});case 2:return r=e.sent,e.t0=L,e.next=6,r.json();case 6:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=function(){var e=Object(h.g)(),t=Object(n.useState)({ready:!1}),r=Object(s.a)(t,2),i=r[0],o=r[1];if(Object(n.useEffect)((function(){return J.onAuthStateChanged((function(e){return o({ready:!0,user:e})}))}),[]),!i.ready)return a.a.createElement("div",null,"Loading!");if(window.signout=function(){return J.signOut()},!i.user)return"/"!==e.pathname?a.a.createElement(h.a,{to:"/"}):a.a.createElement(H,null);var p={action:K,upload:Y};return a.a.createElement(h.d,null,a.a.createElement(h.b,{path:"/",exact:!0},i.user?a.a.createElement(M,{playerId:i.user.uid,dispatch:p}):a.a.createElement(H,null)),a.a.createElement(h.b,{path:"/g/:gameId",exact:!0},a.a.createElement($,{playerId:i.user.uid,dispatch:p})))},ee=function(){return a.a.createElement(f.c,{firebase:m.a},a.a.createElement(b.a,null,a.a.createElement(Z,null)))},te=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function re(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var r=e.installing;null!=r&&(r.onstatechange=function(){"installed"===r.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}o.a.render(a.a.createElement(ee,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");te?(!function(e,t){fetch(e).then((function(r){var n=r.headers.get("content-type");404===r.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):re(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):re(t,e)}))}}()},49:function(e,t,r){e.exports=r(107)},54:function(e,t,r){},70:function(e,t,r){}},[[49,1,2]]]);
//# sourceMappingURL=main.2456caea.chunk.js.map